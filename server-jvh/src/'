#  Create all protobuf files


add_custom_target(
    generate-proto
    DEPENDS ${CMAKE_BINARY_DIR}/protobuf/videostream.pb.cc
)

set (SHARED_LIBS ${CMAKE_SOURCE_DIR}/shared)



set(VIDEOSTREAM videostream)

add_library (${VIDEOSTREAM} SHARED
    server.cc
    client.cc
    client_tcp.cc
    encoder.cc
    net_stream.cc
    videostream.cc
    stream_encoded.cc
    queue.cc
    client_websocket.cc
    av_util.cc
    ${CMAKE_BINARY_DIR}/protobuf/videostream.pb.cc
    ${SHARED_LIBS}/prototcp.cc
)

target_include_directories (${VIDEOSTREAM} PRIVATE
    ${CMAKE_BINARY_DIR}/protobuf/
    ${CMAKE_CURRENT_SOURCE_DIR}/private_include/
    ${SIGC++_INCLUDE_DIRS}
    ${GTKMM_INCLUDE_DIRS}
    ${FFMPEG_INCLUDE_DIRS}
    ${PROTOBUF_INCLUDE_DIRS}
    ${NOPOLL_INCLUDE_DIRS}
    ${SHARED_LIBS}/include/
)

target_include_directories(${VIDEOSTREAM} PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}/public_include/
    )


target_link_libraries (${VIDEOSTREAM}
    ${GTKMM_LIBRARIES}
    ${NOPOLL_LIBRARIES}
    ${FFMPEG_LIBRARIES}
    ${PROTOBUF_LIBRARIES}
    ${SIGC++_LIBRARIES}
)

add_dependencies (${VIDEOSTREAM} protoc)

